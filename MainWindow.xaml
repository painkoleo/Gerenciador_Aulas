<!--
=====================================================
🧠 GERENCIADOR DE AULAS - INTERFACE PRINCIPAL (MainWindow.xaml)
Versão: 1.6 - Comentada Didaticamente
=====================================================
Descrição:
Esta janela exibe:
 - Seletor de pasta + caminho
 - Botões de controle (reproduzir, próxima aula, parar, atualizar)
 - TreeView de pastas e vídeos
 - Barra de progresso
 - Indicação do vídeo atual em reprodução
 - Suporte a Drag & Drop
-->

<Window x:Class="GerenciadorAulas.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:GerenciadorAulas"
        Title="Gerenciador de Aulas 1.4.1"
        Height="720"
        Width="850"
        Background="#1e1e1e"
        Foreground="White"
        Loaded="Window_Loaded"
        AllowDrop="True"
        Drop="Window_Drop"
        DragOver="Window_DragOver">

    <!-- =====================================================
         🎨 RECURSOS GLOBAIS
         =====================================================
         Conversor para alternar cores das linhas do TreeView (efeito zebra)
    -->
    <Window.Resources>
        <local:AlternatingRowBrushConverter x:Key="ZebraConverter"
                                            Brush1="#1e1e1e"
                                            Brush2="#2d2d2d"/>
    </Window.Resources>

    <!-- =====================================================
         🧱 GRID PRINCIPAL
         4 LINHAS:
         0 -> Seletor de pasta
         1 -> Botões de controle
         2 -> TreeView
         3 -> Rodapé (barra de progresso + vídeo atual)
    ===================================================== -->
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Linha 0: Pasta -->
            <RowDefinition Height="Auto"/> <!-- Linha 1: Botões -->
            <RowDefinition Height="*"/>    <!-- Linha 2: TreeView -->
            <RowDefinition Height="Auto"/> <!-- Linha 3: Rodapé -->
        </Grid.RowDefinitions>

        <!-- =====================================================
             📂 Linha 0 - Seletor de pasta
        ===================================================== -->
        <StackPanel Orientation="Horizontal" Margin="0 0 0 10" Grid.Row="0">
<Button x:Name="BtnSelectFolder"
        Width="45" Height="35"
        Background="#4a90e2"
        ToolTip="Selecionar Pasta"
        Click="BtnSelectFolder_Click">
    <Image Source="pack://application:,,,/Resources/folder.png"
           Stretch="Uniform"/>
</Button>
            <TextBox x:Name="txtFolderPath"
                     Width="650" Height="35"
                     IsReadOnly="True"
                     VerticalContentAlignment="Center"
                     Background="#333333"
                     Foreground="White"/>
        </StackPanel>

<!-- 🎬 Linha 1 - Botões de controle de reprodução -->
<StackPanel Grid.Row="1"
            Orientation="Horizontal"
            Margin="0 0 0 10"
            HorizontalAlignment="Left">

    <!-- ▶ Reproduzir vídeo selecionado -->
    <Button Width="45" Height="35"
            Background="#4CAF50"
            ToolTip="Reproduzir vídeo selecionado"
            Command="{Binding PlayCommand}"
            CommandParameter="{Binding SelectedItem, ElementName=treeModules}"
            Margin="0,0,10,0">
        <Image Source="pack://application:,,,/Resources/play.png"
               Stretch="Uniform"/>
    </Button>

    <!-- ▶ Próxima aula -->
    <Button x:Name="BtnNextVideo"
            Width="45" Height="35"
            Background="#9E9E9E"
            ToolTip="Assistir próxima aula"
            Click="BtnNextVideo_Click"
            Margin="0,0,10,0">
        <Image Source="pack://application:,,,/Resources/next.png"
               Stretch="Uniform"/>
    </Button>

    <!-- ⏹ Parar reprodução -->
    <Button x:Name="BtnStop"
            Width="45" Height="35"
            Background="#F44336"
            ToolTip="Parar reprodução"
            Click="BtnStop_Click"
            Margin="0,0,10,0">
        <Image Source="pack://application:,,,/Resources/stop.png"
               Stretch="Uniform"/>
    </Button>

    <!-- 🔄 Atualizar lista -->
    <Button Width="45" Height="35"
            Background="#FFA726"
            ToolTip="Atualizar lista"
            Click="BtnRefresh_Click">
        <Image Source="pack://application:,,,/Resources/refresh.png"
               Stretch="Uniform"/>
    </Button>
</StackPanel>



        <!-- =====================================================
             🌳 Linha 2 - TreeView principal
             Exibe pastas (FolderItem) e vídeos (VideoItem)
        ===================================================== -->
<TreeView x:Name="treeModules"
          Grid.Row="2"
          ItemsSource="{Binding TreeRoot}"
          BorderBrush="#555555"
          BorderThickness="1"
          FontSize="14"
          Background="#1e1e1e"
          AlternationCount="2"
          AllowDrop="True"
          Drop="TreeModules_Drop"
          DragOver="TreeModules_DragOver">

    <!-- Comportamento padrão de itens -->
    <TreeView.ItemContainerStyle>
        <Style TargetType="TreeViewItem">
            <Setter Property="IsExpanded" Value="False"/>
        </Style>
    </TreeView.ItemContainerStyle>

    <!-- =====================================================
         🎞️ Templates para itens internos com ícones
    ===================================================== -->
    <TreeView.Resources>

        <!-- Template de vídeo -->
        <DataTemplate DataType="{x:Type local:VideoItem}">
            <Grid Background="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem},
                                       Path=(ItemsControl.AlternationIndex),
                                       Converter={StaticResource ZebraConverter}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Checkbox de “assistido” -->
                <CheckBox IsChecked="{Binding IsChecked, Mode=TwoWay}"
                          VerticalAlignment="Center"
                          Margin="5,0,0,0"/>

                <!-- Ícone do vídeo -->
                <Image Grid.Column="1"
                       Source="pack://application:,,,/Resources/video.png"
                       Width="20" Height="20"
                       VerticalAlignment="Center"
                       Margin="5,0,0,0"/>

                <!-- Nome do vídeo -->
                <TextBlock Grid.Column="2"
                           Text="{Binding Name}"
                           VerticalAlignment="Center"
                           Foreground="White"
                           TextTrimming="CharacterEllipsis"/>
            </Grid>
        </DataTemplate>

        <!-- Template de pasta -->
        <HierarchicalDataTemplate DataType="{x:Type local:FolderItem}" ItemsSource="{Binding Children}">
            <Grid Background="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem},
                                       Path=(ItemsControl.AlternationIndex),
                                       Converter={StaticResource ZebraConverter}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Checkbox da pasta -->
                <CheckBox IsChecked="{Binding IsChecked, Mode=TwoWay}"
                          VerticalAlignment="Center"
                          Margin="5,0,0,0"/>

                <!-- Ícone da pasta -->
                <Image Grid.Column="1"
                       Source="pack://application:,,,/Resources/folder.png"
                       Width="20" Height="20"
                       VerticalAlignment="Center"
                       Margin="5,0,0,0"/>

                <!-- Nome da pasta + contador -->
                <TextBlock Grid.Column="2"
                           Text="{Binding DisplayName}"
                           VerticalAlignment="Center"
                           Foreground="White"
                           TextTrimming="CharacterEllipsis"/>
            </Grid>
        </HierarchicalDataTemplate>

    </TreeView.Resources>
</TreeView>

        <!-- =====================================================
             📊 Linha 3 - Rodapé: progresso e vídeo atual
        ===================================================== -->
        <StackPanel Grid.Row="3" Orientation="Vertical" Margin="0,10,0,0">

            <!-- Barra de progresso + label -->
            <StackPanel Orientation="Horizontal">
                <ProgressBar x:Name="progressBar"
                             Height="25" Width="700"
                             Minimum="0" Maximum="100"
                             Foreground="#4a90e2"
                             Background="#555555"/>
                <Label x:Name="lblProgress"
                       Content="0%"
                       Margin="10,0,0,0"
                       VerticalAlignment="Center"
                       FontWeight="Bold"/>
            </StackPanel>

            <!-- Label do vídeo atualmente reproduzido -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,0">
                <Label Content=" " FontWeight="Bold" VerticalAlignment="Center" Width="120"/>
                <Label x:Name="lblVideoAtual"
                       Content=""
                       VerticalAlignment="Center"
                       Foreground="#4a90e2"
                       FontSize="14"
                       FontWeight="Bold"/>
            </StackPanel>
        </StackPanel>
    </Grid>
</Window>
